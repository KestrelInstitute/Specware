#!/bin/sh
(shopt -s igncr) 2>/dev/null && shopt -s igncr;  # Ignore cr's

LISP_MODE=SBCL

# $HOME/Specware4/Library/Base/older

xemacs=`which xemacs`
act='launch Specware'

OLDPATH=$PATH
PATH=/bin:/usr/bin:/etc:/sbin:/usr/sbin:${PATH}

# Test whether SPECWARE4 has been set

if [ -z "$SPECWARE4" ]; then
    echo "Failed to $act, SPECWARE4 environment variable not set" 2>&1
    exit 1
fi

# Test whether SPECWARE4 is a directory

if [ ! -d "$SPECWARE4" ]; then
   echo "Failed to $act, $SPECWARE4 is not a directory" 2>&1
   exit 1
fi

# Ensure SPECWARE4 is set to full pathname:
case "$SPECWARE" in
    /*) : ok;;
    *)  SPECWARE="`pwd`/$SPECWARE";;
esac

echo "\$SPECWARE4=$SPECWARE4"

# Test whether SPECWARE4 has been set
if [ -z "$SPECWARE4" ]; then
    echo "Failed to $act, SPECWARE4 environment variable not set" 2>&1
    exit 1
fi

# Test whether SPECWARE4 is a directory
if [ ! -d "$SPECWARE4" ]; then
   echo "Failed to $act, $SPECWARE4 is not a directory" 2>&1
   exit 1
fi

# Ensure SPECWARE4 is set to full pathname:
case "$SPECWARE" in
    /*) : ok;;
    *)  SPECWARE="`pwd`/$SPECWARE";;
esac

if [ ! -d "$SPECWARE4"/Applications/Specware ]; then
   echo "Failed to $act: could not find directory
   $SPECWARE4/Applications/Specware" 2>&1
   exit 1
fi

SPECWARE_BIN="$SPECWARE4"/Applications/Specware/bin/windows


if [ -z "$SWPATH" ]; then
  export SWPATH="C:/cygwin;/"
fi


if [ -z "$SPECWARE_INIT_FORM" ]; then
   SPECWARE_INIT_FORM=NIL
   export SPECWARE_INIT_FORM
fi

# Try to find lisp executable:

BIN_DIR=$SPECWARE_BIN

#. $SPECWARE4/Scripts/unix/Verify_$LISP_MODE

LISP_DIR=`dirname "$LISP"`
LISP_EXECUTABLE="$SPECWARE_BIN"/Specware4.exe
LISP_HEAP_IMAGE=NONE
LISP_DIRECTORY="$SPECWARE4"/
export LISP_EXECUTABLE
export LISP_HEAP_IMAGE
export LISP_DIRECTORY

PATH=$OLDPATH
$xemacs -l "$SPECWARE4"/Library/IO/Emacs/load-slime $* -f run-specware4 &

