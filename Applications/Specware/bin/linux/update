#!/bin/bash --noprofile 

# This is incomplete and does not work yet.

# The --noprofile and --norc inhibit the loading of all user "." files.

# The following turns on echoing of all shell commands
set -v

# There are two ways this might work. We could oblige the user to set
# SPECWARE4 .. or we can assume that the user wants to work in the
# directory where they are at present ...

# Where should the startup and bootstrap scripts go? In
#  /usr/local/kestrel/bin
#  /usr/local/bin
# then they could read ~/.specware I suppose which, at installation
# time, could contain initialization of SPECWARE4 and SWPATH variables.
# But is this going to work on remove sites?
# Should we checkout a version of Specware, or some of it, to /usr/local/

# Should we create a ~/.specware file to set variables for the user?

if [ -z $SPECWARE4 ] ; then
  echo The shell environment variable SPECWARE4 must hold the root
  echo directory of an existing Specware4 distribution, or the location
  echo where Specware4 is to be installed.
  exit 1
fi

cd $SPECWARE4
  
# If a CVS directory exists, then we assume that it has been checked
# out in which case all we want to do is a CVS update. If the directory
# doesn't exist, then we check it out. First we check to see if there is
# an NFS-mounted directory containing the repository. Failing that,
# we get it over the net with cvs.

if [ -d CVS ] ; then
  cvs -q update -d
else
  if [ -d /specware/cvs ]; then
    CVSROOT=/specware/cvs
  else
    if [ -d /net/flycatcher/specware/cvs ]; then
      CVSROOT=/net/flycatcher/specware/cvs
    else
      echo The CVS repository for Specware is not locally accessible.
      echo An attempt will be made to retrieve Specware over the net
      echo using ssh.
      CVSROOT=`logname`@crake.kestrel.edu:/specware/cvs
      CVS_RSH=ssh
    fi
  fi
  cd ..
  cvs -d $REPOSITORY checkout Specware4
  if [ -d Specware4 ]; then
    cd Specware4
  else
    echo Checkout of Specware4 failed.
    exit 1
  fi
  # Now retrieve the generated Specware4 for bootstrapping.
  # Should probably check it put to /tmp ... and then copy it to
  # the correct place.
fi
