#!/bin/sh

## Hack by Jim McDonald, Fri Apr 18, 2003
## Once per installation xemacs/cmucl ilisp interface
## See $SPECWARE4/Library/IO/Emacs/compile-misc-ilisp-files.el

## This script establishes Emacs/ilisp as a directory and runs ilisp-compile-inits
## This eliminates some startup complaints from cmucl that would require 
## (once per user per installation) manual intervention to eliminate.

## Running this multiple times should be harmless.

cd ${SPECWARE4}/Library/IO/Emacs/
if [ ! -e ilisp ]; then
  ln -s ilisp-20020831 ilisp
fi

echo ""
echo "ilisp/ should be a directory (or a link to one) containing many files, including ilisp.el"
echo ""
ls -sltd ilisp
ls -sltd ilisp/ilisp.el
echo ""

cd ilisp

DOIT=NO
if [ ! -e cl-ilisp.x86f ]; then
  DOIT=YES
fi
if [ ! -e cmulisp.x86f ]; then
  DOIT=YES
fi
if [ ! -e ilisp-pkg.x86f ]; then
  DOIT=YES
fi

if [ "$DOIT" == "YES" ]; then
  echo "About to run ilisp-compile-inits within xemacs, to compile ilisp-pkg.lisp, cmulisp.lisp, cl-ilisp.lisp"
  # This is magic mumbo-jumbo -- more straightforward attempts to compile the files seem to fail in obscure ways.
  # See the note in compile-misc-ilisp-files.el
  xemacs -l "$SPECWARE4"/Library/IO/Emacs/load-ilisp \
         -l "$SPECWARE4"/Library/IO/Emacs/compile-misc-ilisp-files \
         -geometry =150x60+20+20 
  echo "Done compiling."
  echo "Should now see three or more x86f files:"
else
  echo "No need to run ilisp-compile-inits within xemacs, since the following files already exist:"
fi
echo ""
ls -sltr *.x86f
echo ""
echo ""
