#!/bin/sh

xemacs=`which xemacs`
export act='test Specware4 using ACL'

PATH=/bin:/usr/bin:/etc:/sbin:/usr/sbin:/usr/local/bin

# bash convention for . means the file is processed inline (as if copied here)

. $SPECWARE4/Scripts/unix/Verify_Specware4
. $SPECWARE4/Scripts/unix/Verify_Lisp ACL

cd $SPECWARE4

export LISP_EXECUTABLE="$LISP"
export LISP_HEAP_IMAGE="${BIN_DIR}/${APP_NAME}.${IMAGE_EXTENSION}"
export LISP_DIRECTORY="$SPECWARE4"
ACL_DIR=`dirname "$LISP"`

xemacs=`which xemacs`

LOG_FILE=/tmp/test-specware4-acl-`/bin/date +"%y%m%d-%H%M%S"`

/bin/date
echo "About to run tests under $SPECWARE4/TestSuite/$1"
echo "Waiting for $LOG_FILE ..."

# default value of fi:lisp-evalserver-number-reads is 200
# This means that after 200 calls to eval-in-emacs from lisp,
# no futher -eval commands provided here would execute.
# We print a mini-buffer progress msg for each test,
# so make the value very much larger -- 100000.

$xemacs -geometry 137x50-50-50 \
        -name "Specware4" \
        -title "Specware4" \
        -l "$ACL_DIR"/xeli/fi-site-init \
	-l "$SPECWARE4"/Library/IO/Emacs/load\
	-eval "(set-face-background 'default \"lightyellow\")"\
        -eval "(sw:eval-in-lisp \"(load (compile-file \\\"$SPECWARE4/Applications/Handwritten/Lisp/test-harness\\\"))\")" \
        -eval "(sw:eval-in-lisp \"(setq specware-test::*quiet-about-dirs?* t)\")" \
        -eval "(setq fi:lisp-evalserver-number-reads 100000)" \
        -eval "(sw:eval-in-lisp \"(load \\\"$SPECWARE4/Applications/Specware/Tests/test-specware4\\\")\")" \
        -eval "(sw:eval-in-lisp \"(test-specware4-subdir \\\"$1\\\" \\\"$LOG_FILE\\\")\")" \
        -eval "(progn (fi:eval-in-lisp-asynchronous \"(exit-from-lisp 0)\") (kill-emacs 0))"

/bin/date
echo "-------------"
echo "Test results:"

cat $LOG_FILE
echo "-------------"



