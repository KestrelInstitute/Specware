#!/bin/sh

act='launch Specware'

PATH=/bin:/usr/bin:/etc:/sbin:/usr/sbin:${PATH}

if [ ! -d "$defaultemacsapp" ]; then
   defaultemacsapp=/Applications/Emacs.app
fi

if [ -d $defaultemacsapp ]; then
    echo setting EmacsApp to $defaultemacsapp 2>&1
    EmacsApp=$defaultemacsapp
fi

if [ ! -d "$EmacsApp" ]; then
    EmacsApp="$HOME"/Applications/Emacs.app
    if [ ! -d "$EmacsApp" ]; then
       echo Cannot find Emacs in /Applications/Emacs.app or ~/Applications/Emacs.app 2>&1
       exit 1
    fi
fi

# Test whether SPECWARE4 has been set

if [ -z "$SPECWARE4" ]; then
    echo "SPECWARE4 environment variable not set -- using default value." 2>&1
    export SPECWARE4="$HOME"/Specware
fi

# Test whether SPECWARE4 is a directory

if [ ! -d "$SPECWARE4" ]; then
   echo "Failed to $act, $SPECWARE4 is not a directory" 2>&1
   exit 1
fi

# Ensure SPECWARE4 is set to full pathname:

case "$SPECWARE4" in
    /*) : ok;;
    *)  SPECWARE4="`pwd`/$SPECWARE4";;
esac

echo "\$SPECWARE4=$SPECWARE4"
cd $SPECWARE4

# Test whether SPECWARE4 has been set

if [ -z "$SPECWARE4" ]; then
    echo "Failed to $act, SPECWARE4 environment variable not set" 2>&1
    exit 1
fi

# Test whether SPECWARE4 is a directory

if [ ! -d "$SPECWARE4" ]; then
   echo "Failed to $act, $SPECWARE4 is not a directory" 2>&1
   exit 1
fi

# Ensure SPECWARE4 is set to full pathname:

case "$SPECWARE4" in
    /*) : ok;;
    *)  SPECWARE4="`pwd`/$SPECWARE4";;
esac

if [ ! -d "$SPECWARE4"/Applications/Specware ]; then
   echo "Failed to $act: could not find directory
   $SPECWARE4/Applications/Specware" 2>&1
   exit 1
fi

SPECWARE_BIN="$SPECWARE4"/Applications/Specware/bin/linux

# Ensure SWPATH is set

if [ -z "$SWPATH" ]; then
  export SWPATH="$SPECWARE4:/"
fi

# Try to find lisp executable:

if [ -z "$LISP" ]; then
   for L in /Applications/sbcl/bin/sbcl /usr/local/bin/sbcl "$HOME"/bin/sbcl /bin/lisp; do
      if [ -x "$L" ]; then
         LISP="$L"; break
      fi
   done
fi

if [ -z "$LISP" ]; then
   echo "Failed to $act, no LISP executable found" 2>&1
   exit 1
fi

if [ ! -x "$LISP" ]; then
   echo "Failed to $act, $LISP is not executable" 2>&1
   exit 1
fi

if [ -z "$SPECWARE_INIT_FORM" ]; then
   SPECWARE_INIT_FORM=NIL
   export SPECWARE_INIT_FORM
fi

LISP_DIR=`dirname "$LISP"`
LISP_EXECUTABLE="$SPECWARE_BIN"/Specware4.sbclexe
LISP_HEAP_IMAGE=NONE
LISP_DIRECTORY="$SPECWARE4"/
export LISP LISP_EXECUTABLE LISP_HEAP_IMAGE LISP_DIRECTORY

echo "\$EmacsApp=$EmacsApp"

open "$EmacsApp" --args -l "$SPECWARE4"/Library/IO/Emacs/load-slime \
       -f run-specware4
#       -name "Specware" \
#       -title "Specware" \
#       -geometry =150x60+20+20 \
